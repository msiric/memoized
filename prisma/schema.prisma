generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccessOptions {
  FREE
  PREMIUM
}

enum SubscriptionPlan {
  MONTHLY
  YEARLY
  LIFETIME
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
}

enum ProblemDifficulty {
  EASY
  MEDIUM
  HARD
}

enum BannerType {
  INFO
  WARNING
  SUCCESS
}

model User {
  id              String                @id @default(uuid())
  name            String?
  email           String                @unique
  image           String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  accounts        Account[]
  customer        Customer?
  lessonProgress  UserLessonProgress[]
  problemProgress UserProblemProgress[]
}

model Customer {
  id               String         @id @default(uuid())
  stripeCustomerId String         @unique
  userId           String         @unique
  user             User           @relation(fields: [userId], references: [id])
  subscriptions    Subscription[]
}

model Account {
  id                String   @id @default(uuid())
  userId            String
  provider          String
  providerAccountId String   @unique
  createdAt         DateTime @default(now())
  user              User     @relation(fields: [userId], references: [id])

  @@unique([provider, providerAccountId])
}

model Lesson {
  id             String               @id @default(uuid())
  order          Int
  href           String
  title          String
  description    String?
  slug           String               @unique
  body           String
  access         AccessOptions        @default(FREE)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  sectionId      String
  section        Section              @relation(fields: [sectionId], references: [id])
  problems       Problem[]
  lessonProgress UserLessonProgress[]
}

model Subscription {
  id                   String             @id @default(uuid())
  customerId           String
  stripeSubscriptionId String             @unique
  plan                 SubscriptionPlan
  status               SubscriptionStatus
  startDate            DateTime
  endDate              DateTime?
  metadata             Json?
  priceId              String?
  cancelAtPeriodEnd    Boolean            @default(false)
  cancelAt             DateTime?
  canceledAt           DateTime?
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  customer             Customer           @relation(fields: [customerId], references: [id])
}

model UserLessonProgress {
  id          String   @id @default(uuid())
  userId      String
  lessonId    String
  completed   Boolean  @default(false)
  completedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
  lesson      Lesson   @relation(fields: [lessonId], references: [id])

  @@unique([userId, lessonId])
}

model Course {
  id          String    @id @default(uuid())
  order       Int
  title       String
  description String?
  href        String
  slug        String    @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now())
  sections    Section[]
}

model Section {
  id          String   @id @default(uuid())
  order       Int
  title       String
  description String?
  href        String
  body        String
  slug        String   @unique
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id])
  lessons     Lesson[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model Problem {
  id              String                @id @default(uuid())
  title           String
  href            String                @unique
  difficulty      ProblemDifficulty
  lessonId        String
  lesson          Lesson                @relation(fields: [lessonId], references: [id])
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @default(now())
  problemProgress UserProblemProgress[]
}

model UserProblemProgress {
  id          String   @id @default(uuid())
  userId      String
  problemId   String
  completed   Boolean  @default(false)
  completedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
  problem     Problem  @relation(fields: [problemId], references: [id])

  @@unique([userId, problemId])
}

model Banner {
  id        String     @id @default(uuid())
  title     String     @unique
  message   String
  type      BannerType
  linkText  String?
  linkUrl   String?
  isActive  Boolean    @default(true)
  startDate DateTime
  endDate   DateTime
  priority  Int        @default(0)
}